<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Extension block callback â€¢ blockr.dag</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="block-callback_files/libs/quarto-html/popper.min.js"></script><script src="block-callback_files/libs/quarto-html/tippy.umd.min.js"></script><link href="block-callback_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="block-callback_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extension block callback">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">blockr.dag</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/blockr.dag.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-extend" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Extend</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-extend">
<li><a class="dropdown-item" href="../articles/context-menu.html">Context Menu Items</a></li>
    <li><a class="dropdown-item" href="../articles/toolbar.html">Toolbar Items</a></li>
    <li><a class="dropdown-item" href="../articles/block-callback.html">Block callbacks</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Extension block callback</h1>





      <div class="d-none name"><code></code></div>
    </div>






    <div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bristolmyerssquibb.github.io/blockr.dag/">blockr.dag</a></span><span class="op">)</span></span></code></pre></div>
</div>
<section class="level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>An <strong>extension block callback</strong> is run in the block context, that is part of blockr.dock. blockr.dock exposes a generic, namely <code><a href="https://bristolmyerssquibb.github.io/blockr.dock/reference/extension.html" class="external-link">extension_block_callback()</a></code>. Each blockr extension, like blockr.dag, can provide its own method.</p>
</section><section class="level2"><h2 id="add-badge-status-to-dag-nodes">Add badge status to DAG nodes<a class="anchor" aria-label="anchor" href="#add-badge-status-to-dag-nodes"></a>
</h2>
<p>The motivation behind this mechanism is to update node state according to any block status change. For instance, if a block needs incoming data but does not have incoming connections, we may want to display an error badge on the node. If any error occurs during the block execution, we display a badge.</p>
<p>The <code><a href="https://bristolmyerssquibb.github.io/blockr.dock/reference/extension.html" class="external-link">extension_block_callback()</a></code> DAG method returns a function with the following signature:</p>
<ul>
<li>
<code>x</code> is the extension object.</li>
<li>
<code>id</code> is the block id.</li>
<li>
<code>board</code> is the board object.</li>
<li>
<code>update</code> contains reactive values describing the board current actions.</li>
<li>
<code>conditions</code> contains reactive values that return a list of conditions associated with the block state.</li>
<li>
<code>dag_extension</code> is the extension instance. It is what is returned by the extension at the bottom of the main server function:</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    graph <span class="op">=</span> <span class="fu">reactive</span><span class="op">(</span></span>
<span>      <span class="va">input</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">graph_id</span><span class="op">(</span><span class="op">)</span>, <span class="st">"-state"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  proxy <span class="op">=</span> <span class="va">proxy</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In the callback we need it to get the DAG proxy object containing the correct <strong>namespace</strong>, which allows to update the DAG from another module.</p>
<ul>
<li>
<code>session</code> is the current block session, a different namespace as the DAG extension.</li>
</ul>
<p>This callback function returns <code>NULL</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">extension_block_callback.dag_extension</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">id</span>,</span>
<span>    <span class="va">board</span>,</span>
<span>    <span class="va">update</span>,</span>
<span>    <span class="va">conditions</span>,</span>
<span>    <span class="va">dag_extension</span>,</span>
<span>    <span class="va">...</span>,</span>
<span>    <span class="va">session</span> <span class="op">=</span> <span class="fu"><a href="https://bristolmyerssquibb.github.io/blockr.core/reference/get_session.html" class="external-link">get_session</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n_cnd</span> <span class="op">&lt;-</span> <span class="fu">reactive</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu">conditions</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">error</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="va">badge_count</span> <span class="op">&lt;-</span> <span class="fu">reactiveVal</span><span class="op">(</span><span class="fl">0L</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">observeEvent</span><span class="op">(</span></span>
<span>      <span class="fu">req</span><span class="op">(</span><span class="fu">n_cnd</span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0L</span>, <span class="fu">n_cnd</span><span class="op">(</span><span class="op">)</span> <span class="op">!=</span> <span class="fu">badge_count</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="op">{</span></span>
<span>        <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu">n_cnd</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>        <span class="va">badge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          text <span class="op">=</span> <span class="st">""</span>,</span>
<span>          placement <span class="op">=</span> <span class="st">"right-top"</span>,</span>
<span>          backgroundFill <span class="op">=</span> <span class="st">"#dc2626"</span>,</span>
<span>          stroke <span class="op">=</span> <span class="st">"#fff"</span>,</span>
<span>          lineWidth <span class="op">=</span> <span class="fl">2</span>,</span>
<span>          padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>        <span class="va">node_config</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            id <span class="op">=</span> <span class="fu">to_g6_node_id</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,</span>
<span>            style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>              badges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">badge</span><span class="op">)</span></span>
<span>            <span class="op">)</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>        <span class="fu">g6_update_nodes</span><span class="op">(</span><span class="va">dag_extension</span><span class="op">$</span><span class="va">proxy</span>, <span class="va">node_config</span><span class="op">)</span></span>
<span>        <span class="fu">badge_count</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="fu">observeEvent</span><span class="op">(</span></span>
<span>      <span class="fu">req</span><span class="op">(</span><span class="fu">n_cnd</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0L</span>, <span class="fu">badge_count</span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0L</span><span class="op">)</span>,</span>
<span>      <span class="op">{</span></span>
<span>        <span class="va">node_config</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            id <span class="op">=</span> <span class="fu">to_g6_node_id</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,</span>
<span>            style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>              badges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>            <span class="op">)</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>        <span class="fu">g6_update_nodes</span><span class="op">(</span><span class="va">dag_extension</span><span class="op">$</span><span class="va">proxy</span>, <span class="va">node_config</span><span class="op">)</span></span>
<span>        <span class="fu">badge_count</span><span class="op">(</span><span class="fl">0L</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="cn">NULL</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Granjon, Nicolas Bennett, Christoph Sax, Bristol Myers Squibb.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
